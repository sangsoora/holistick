<div class="container practitioner-my-services">
  <div class="d-flex justify-content-between align-items-center">
    <ul class="list-inline tabs-underlined mb-0">
      <li>
        <p class="tab-underlined active-tab">Active <% if @active_serivces.count > 0 %> (<%= @active_serivces.count %>) <% end %></p>
      </li>
      <li>
        <p class="tab-underlined">Deactivated <% if @deactivated_serivces.count > 0 %> (<%= @deactivated_serivces.count%>) <% end %> </p>
      </li>
    </ul>
    <%= link_to 'Add new service', '', data: { toggle: "modal", target: "#newServiceModal" }, class: 'btn btn-flat' %>
  </div>
  <div class="lists">
    <div class="my-services" id="active-list">
      <%= render 'services/active_services_list', active_serivces: @active_serivces %>
    </div>
  </div>
  <div class="lists">
    <div class="my-services" id="deactivated-list">
      <%= render 'services/deactivated_services_list', deactivated_serivces: @deactivated_serivces %>
    </div>
  </div>
</div>
<div class="modal fade" id="newServiceModal" tabindex="-1" role="dialog" aria-labelledby="newServiceModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
       <h5 class="modal-title" id="newServiceModalLabel">New service</h5>
       <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <%= simple_form_for([@service]) do |f| %>
          <%= f.input :name, label: 'Name of the Service' %>
          <div class="form-group select required service_service_type">
            <label class="select required" for="service_service_type">Service type</label>
            <select class="form-control select require" name="service[service_type]" id="service_service_type" required>
              <option value=""></option>
              <option value="Virtual">Virtual</option>
              <% if @practitioner.address %>
                <option value="In-person">In-person</option>
              <% end %>
            </select>
          </div>
          <%= f.input :specialty, as: :select, collection: @practitioner.specialties, require: true %>
          <%= render "service_health_goals/create_form", service: @service %>
          <%= f.input :duration, input_html: { value: 15, min: 15, step: 15 }, require: true %>
          <div class="form-group string required service_price">
            <label class="string required" for="service_price">Price <abbr title="required">*</abbr></label>
            <input class="form-control string required" type="text" name="service[price]" id="service_price">
          </div>
          <%= f.input :description, input_html: { rows: 5 } %>
          <%= f.submit :Create, class: 'btn btn-flat' %>
          <%= link_to 'Cancel', '', class: 'btn btn-ghost ml-3' %>
        <% end %>
      </div>
    </div>
  </div>
</div>
<script>
  var max = 5;
  var checks = document.querySelectorAll(".check");
  for (var i = 0; i < checks.length; i++) {
    checks[i].onclick = selectiveCheck;
  }
  function selectiveCheck (e) {
    var checkedChecks = document.querySelectorAll(".check:checked");
    if (checkedChecks.length >= max + 1) {
      return false;
    } else {
      document.getElementById('create_label_' + e.currentTarget.value).classList.toggle('active');
    }
  }
  <% @practitioner.services.each do |service| %>
    const serviceBtn<%= service.id %> = document.getElementById('service-btn-<%= service.id %>');
    serviceBtn<%= service.id %>.addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('service-<%= service.id %>').style.display = 'none';
      document.getElementById('edit_service_<%= service.id %>').style.display = 'block';
    })
    var checks<%= service.id %> = document.querySelectorAll(".check-<%= service.id %>");
    for (var i = 0; i < checks<%= service.id %>.length; i++) {
      checks<%= service.id %>[i].onclick = selectiveCheck<%= service.id %>;
    }
    function selectiveCheck<%= service.id %> (e) {
      var checkedChecks<%= service.id %> = document.querySelectorAll(".check-<%= service.id %>:checked");
      if (checkedChecks<%= service.id %>.length >= max + 1) {
        return false;
      } else {
        document.getElementById('<%= service.id %>_label_' + e.currentTarget.value).classList.toggle('active');
      }
    }
  <% end %>
  const tabs = document.querySelectorAll('.tab-underlined');
  const lists = document.querySelectorAll('.lists');
  const entries = function*(iterable) {
    let i = 0;
    for (item of iterable) {
      yield [i++, item]
    }
  }
  const showBlock = index => {
    for (const [blockIndex, block] of entries(lists)) {
      block.style.display = blockIndex === index ? 'block' : 'none'
    }
  }
  showBlock(0)
  for (const [tabIndex, tab] of entries(tabs)) {
    tab.addEventListener('click', e => {
      e.preventDefault();
      showBlock(tabIndex);
      const activeTab = document.querySelector('.active-tab');
      if (!e.currentTarget.classList.contains('active-tab')) {
        if (activeTab !== null) {
          activeTab.classList.remove('active-tab');
        }
        e.currentTarget.classList.toggle('active-tab');
      }
    })
  }
</script>
