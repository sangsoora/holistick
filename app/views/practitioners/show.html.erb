<% if @practitioner.status == 'active' %>
  <% content_for :meta_title, "#{@practitioner.user.full_name} on #{DEFAULT_META["meta_product_name"]}" %>
  <% if @practitioner.bio? %>
    <% content_for :meta_description, strip_tags(@practitioner.bio.gsub('"', '\'').gsub(/\n/, '<br/>').split('<br/>')[0]) %>
  <% end %>
  <% if @practitioner.user.photo.attached? %>
    <% content_for :meta_image, cdn_for(@practitioner.user.cropped_image) %>
  <% end %>
<% end %>
<div class="container practitioner-page">
  <div class="practitioner-overview">
    <div class="practitioner-main">
      <% if @practitioner.banner_image.attached? %>
        <img src="<%= cdn_for(@practitioner.banner_image) %>" class="banner" alt="">
      <% else %>
        <%= image_tag('practitioner-bio', alt: 'Holistic Service', class: 'banner') %>
      <% end %>
      <div class="practitioner-info">
        <div class="practitioner-img">
          <% if @practitioner.user.photo.attached? %>
            <img src="<%= cdn_for(@practitioner.user.cropped_image) %>" alt="">
          <% else %>
            <%= image_tag("profile") %>
          <% end %>
          <p class="practitioner-rating">
            <% if @practitioner.reviews.count > 0 %>
              <i class="fas fa-star mr-2 pink-icon"></i><%= @practitioner.rating_avg %> (<%= @practitioner.reviews.count %>)
            <% end %>
          </p>
        </div>
        <div class="practitioner-detail">
          <div class="practitioner-name">
            <div class="d-flex align-items-center">
              <button class="verified">Checked</button>
              <h3><%= @practitioner.user.full_name %></h3>
            </div>
            <div class="practitioner-btn" id="practitioner-btn">
            <% if user_signed_in? && current_user != @practitioner.user %>
              <%= render 'favorite_practitioners/practitioner_btn', practitioner: @practitioner %>
            <% end %>
            </div>
          </div>
          <h4><em><%= @practitioner.title %></em></h4>
          <p><%= @practitioner.specialties.pluck(:name).join(', ') %></p>
          <p><i class="fas fa-map-marker-alt pink-icon"></i> Location: <%= @practitioner.location %></p>
          <p><i class="fas fa-microphone pink-icon"></i> Languages:
            <%= @practitioner.languages.pluck(:name).join(', ') %>
          </p>
          <p><i class="fas fa-stopwatch pink-icon"></i> Experience: <%= @practitioner.experience %></p>
          <p><i class="fas fa-check-circle pink-icon"></i> Accepts Insurance: <%= @practitioner.insurance ? 'Yes' : 'No' %></p>
          <% if @practitioner.address? && @practitioner.address_type == 'Public' %>
            <p><i class="far fa-map pink-icon"></i> Business Address: <%= @practitioner.address %></p>
          <% end %>
        </div>
      </div>
      <div class="practitioner-bio">
        <h4><i class="fas fa-info-circle"></i> About Me</h4>
        <% if @practitioner.bio? %>
          <p><%= @practitioner.bio.gsub(/\n/, '<br/>').html_safe %></p>
        <% end %>
        <h4><i class="far fa-question-circle"></i> Healing Approach</h4>
        <% if @practitioner.approach? %>
          <p><%= @practitioner.approach.gsub(/\n/, '<br/>').html_safe %></p>
        <% end %>
        <% if @practitioner.practitioner_social_links.count > 0 %>
           <h4><i class="far fa-address-book"></i> Contact & Social Media</h4>
          <% if @practitioner.practitioner_social_links.where(media_type: 'Email').count > 0 %>
            <p class='ml-3'>Email: <a href="mailto:<%= @practitioner.practitioner_social_links.where(media_type: 'Email').first.url %>"><%= @practitioner.practitioner_social_links.where(media_type: 'Email').first.url %></a></p>
          <% end %>
        <% end %>
        <% if @practitioner.practitioner_social_links.where(media_type: 'Phone').count > 0 %>
          <p class='ml-3'>Phone: <%= @practitioner.practitioner_social_links.where(media_type: 'Phone').first.url %></p>
        <% end %>
        <% @practitioner.practitioner_social_links.where.not(media_type: ['Email', 'Phone']).sort_by(&:media_type).each do |link| %>
          <p class='ml-3'><%= link.media_type %>: <a href="<%= link.url %>" target="_blank"><%= link.url %></a></p>
        <% end %>
        <h4><i class="fas fa-award"></i> Education & Certification</h4>
        <% if @practitioner.practitioner_certifications.where(certification_type: 'Education').count > 0 %>
          <p><strong>Education</strong>: <%= @practitioner.practitioner_certifications.where(certification_type: 'Education').pluck(:name).join(', ') %></p>
        <% end %>
        <% if @practitioner.practitioner_certifications.where(certification_type: 'Certification').count > 0 %>
          <p><strong>Certification</strong>: <%= @practitioner.practitioner_certifications.where(certification_type: 'Certification').pluck(:name).join(', ') %></p>
        <% end %>
        <h4><i class="fas fa-users"></i> Professional Membership</h4>
        <p><%= @practitioner.practitioner_memberships.pluck(:name).join(', ') %></p>
      </div>
      <div class="practitioner-services">
        <h4><i class="fas fa-shopping-cart"></i> Services</h4>
        <% @practitioner.services.where(active: true).each do |service| %>
          <div class="practitioner-service">
            <div class="practitioner-service-info">
              <div class="practitioner-service-summary">
                <div class="practitioner-service-title">
                  <h4><%= service.name %></h4>
                  <% if current_user != @practitioner.user %>
                    <%= link_to 'Details', service_path(service), class: 'btn btn-flat' %>
                  <% end %>
                </div>
                <div class="practitioner-service-icons">
                  <% if service.reviews.count > 0 %>
                    <div class="text-left">
                      <p><i class="fas fa-star mr-2 pink-icon"></i><%= service.rating_avg %> (<%= service.reviews.count %>)</p>
                    </div>
                  <% end %>
                  <% if service.service_promotions.exists? && service.active_promotion? %>
                    <div <%= service.reviews.count == 0 ? 'class=text-left' : '' %>>
                      <p style="color: red; font-weight: 600; margin-bottom: 0.125rem;"><i class="fas fa-coins mr-2 pink-icon"></i>CA$ <%= number_with_precision((service.price - (service.price * service.last_promotion.discount_percentage / 100)), precision: 2, delimiter: ',') %></p>
                      <p class="small" style="color: red; margin-bottom: 0.125rem;">
                        <% if (service.last_promotion.end_date.to_date - Time.now.to_date).to_i > 1 %>
                          (<%= (service.last_promotion.end_date.to_date - Time.now.to_date).to_i %> days left)
                        <% elsif ((service.last_promotion.end_date.to_time - Time.now.to_time) / 1.hours).to_i > 1 %>
                          (<%= ((service.last_promotion.end_date.to_time - Time.now.to_time) / 1.hours).to_i  %> hours left)
                        <% else %>
                          (<%= ((service.last_promotion.end_date.to_time - Time.now.to_time) / 1.minutes).to_i  %> minutes left)
                        <% end %>
                      </p>
                      <p class="small" style="color: #366735;"><span style="text-decoration: line-through;"> CA$ <%= number_with_precision(service.price, precision: 2, delimiter: ',') %> </span> (<%= service.last_promotion.discount_percentage %>% off)</p>
                    </div>
                  <% else %>
                    <div <%= service.reviews.count == 0 ? 'class=text-left' : '' %>>
                      <p><i class="fas fa-coins mr-2 pink-icon"></i>CA$ <%= number_with_precision(service.price, precision: 2, delimiter: ',') %></p>
                    </div>
                  <% end %>
                  <p><i class="fas fa-location-arrow mr-2 pink-icon"></i> <%= service.service_type %></p>
                  <div class="text-right">
                    <p><i class="far fa-clock mr-2 pink-icon"></i> <%= service.duration %>m</p>
                  </div>
                </div>
              </div>
              <div class="practitioner-service-description">
                <p><%= service.description.gsub(/\n/, '<br/>').html_safe %></p>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <% if @practitioner.reviews.count > 0 %>
        <div class="practitioner-review">
          <h4><i class="far fa-comment"></i> Reviews</h4>
          <% @practitioner.reviews.order('created_at DESC').each do |review| %>
            <div class="review-box">
              <div class="d-flex justify-content-between mb-2">
                <p><% review.rating.times { %> <i class="fas fa-star pink-icon"></i> <% } %></p>
                <p><small><i><%= review.session.service.name %></i></small></p>
              </div>
              <div><p id="review-text-<%= review.id %>"><%= review.comment.gsub(/\n/, '<br/>').html_safe %></p></div>
              <div class="d-flex justify-content-end">
                <p><small><i><%= review.session.user.full_name %></i></small></p>
                <p class="ml-2"><small><i><%= review.created_at.strftime('%b %d, %Y') %></i></small></p>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
    <div class="practitioner-sidebar">
      <div class="practitioner-video">
        <div class="embed-responsive embed-responsive-16by9">
          <% if @practitioner.video.nil? || @practitioner.video == '' %>
            <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/Zli7s5QhQrI" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          <% else %>
            <iframe class="embed-responsive-item" src="<%= @practitioner.video %>" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          <% end %>
        </div>
      </div>
      <div class="practitioner-timetable mt-3">
        <p>Practitioner working hours<br>(in your current time zone: <span id='time-zone'></span>)</p>
        <table class='working-hours'>
          <tr>
            <th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th><th></th>
          </tr>
          <% if user_signed_in? && current_user.timezone? %>
            <tr>
              <% (0..6).to_a.each do |num| %>
                <% if @practitioner.converted_working_hours(current_user)[num] != [] %>
                  <% if (@practitioner.converted_working_hours(current_user)[num].first[:starts] < '04:00') && (@practitioner.converted_working_hours(current_user)[num].first[:ends] != '00:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].first[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].first[:ends] %></p></div></div></td>
                  <% elsif (@practitioner.converted_working_hours(current_user)[num].last[:starts] < '04:00') && (@practitioner.converted_working_hours(current_user)[num].last[:ends] != '00:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].last[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].last[:ends] %></p></div></div></td>
                  <% else %>
                    <td></td>
                  <% end %>
                <% else %>
                  <td></td>
                <% end %>
              <% end %>
              <td class='time'>00 ~ 04</td>
            </tr>
            <tr>
              <% (0..6).to_a.each do |num| %>
                <% if @practitioner.converted_working_hours(current_user)[num] != [] %>
                  <% if (@practitioner.converted_working_hours(current_user)[num].first[:starts] < '04:00' && @practitioner.converted_working_hours(current_user)[num].first[:ends] > '08:00') || (@practitioner.converted_working_hours(current_user)[num].first[:starts] >= '04:00' && @practitioner.converted_working_hours(current_user)[num].first[:starts] < '08:00') || (@practitioner.converted_working_hours(current_user)[num].first[:ends] > '04:00' && @practitioner.converted_working_hours(current_user)[num].first[:ends] <= '08:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].first[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].first[:ends] %></p></div></div></td>
                  <% elsif (@practitioner.converted_working_hours(current_user)[num].last[:starts] < '04:00' && @practitioner.converted_working_hours(current_user)[num].last[:ends] > '08:00') || (@practitioner.converted_working_hours(current_user)[num].last[:starts] >= '04:00' && @practitioner.converted_working_hours(current_user)[num].last[:starts] < '08:00') || (@practitioner.converted_working_hours(current_user)[num].last[:ends] > '04:00' && @practitioner.converted_working_hours(current_user)[num].last[:ends] <= '08:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].last[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].last[:ends] %></p></div></div></td>
                  <% else %>
                    <td></td>
                  <% end %>
                <% else %>
                  <td></td>
                <% end %>
              <% end %>
              <td class='time'>04 ~ 08</td>
            </tr>
            <tr>
              <% (0..6).to_a.each do |num| %>
                <% if @practitioner.converted_working_hours(current_user)[num] != [] %>
                  <% if (@practitioner.converted_working_hours(current_user)[num].first[:starts] < '08:00' && @practitioner.converted_working_hours(current_user)[num].first[:ends] > '12:00') || (@practitioner.converted_working_hours(current_user)[num].first[:starts] >= '08:00' && @practitioner.converted_working_hours(current_user)[num].first[:starts] < '12:00') || (@practitioner.converted_working_hours(current_user)[num].first[:ends] > '08:00' && @practitioner.converted_working_hours(current_user)[num].first[:ends] <= '12:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].first[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].first[:ends] %></p></div></div></td>
                  <% elsif (@practitioner.converted_working_hours(current_user)[num].last[:starts] < '08:00' && @practitioner.converted_working_hours(current_user)[num].last[:ends] > '12:00') || (@practitioner.converted_working_hours(current_user)[num].last[:starts] >= '08:00' && @practitioner.converted_working_hours(current_user)[num].last[:starts] < '12:00') || (@practitioner.converted_working_hours(current_user)[num].last[:ends] > '08:00' && @practitioner.converted_working_hours(current_user)[num].last[:ends] <= '12:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].last[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].last[:ends] %></p></div></div></td>
                  <% else %>
                    <td></td>
                  <% end %>
                <% else %>
                  <td></td>
                <% end %>
              <% end %>
              <td class='time'>08 ~ 12</td>
            </tr>
            <tr>
              <% (0..6).to_a.each do |num| %>
                <% if @practitioner.converted_working_hours(current_user)[num] != [] %>
                  <% if (@practitioner.converted_working_hours(current_user)[num].first[:starts] < '12:00' && @practitioner.converted_working_hours(current_user)[num].first[:ends] > '16:00') || (@practitioner.converted_working_hours(current_user)[num].first[:starts] >= '12:00' && @practitioner.converted_working_hours(current_user)[num].first[:starts] < '16:00') || (@practitioner.converted_working_hours(current_user)[num].first[:ends] > '12:00' && @practitioner.converted_working_hours(current_user)[num].first[:ends] <= '16:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].first[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].first[:ends] %></p></div></div></td>
                  <% elsif (@practitioner.converted_working_hours(current_user)[num].last[:starts] < '12:00' && @practitioner.converted_working_hours(current_user)[num].last[:ends] > '16:00') || (@practitioner.converted_working_hours(current_user)[num].last[:starts] >= '12:00' && @practitioner.converted_working_hours(current_user)[num].last[:starts] < '16:00') || (@practitioner.converted_working_hours(current_user)[num].last[:ends] > '12:00' && @practitioner.converted_working_hours(current_user)[num].last[:ends] <= '16:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].last[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].last[:ends] %></p></div></div></td>
                  <% else %>
                    <td></td>
                  <% end %>
                <% else %>
                  <td></td>
                <% end %>
              <% end %>
              <td class='time'>12 ~ 16</td>
            </tr>
            <tr>
              <% (0..6).to_a.each do |num| %>
                <% if @practitioner.converted_working_hours(current_user)[num] != [] %>
                  <% if (@practitioner.converted_working_hours(current_user)[num].first[:starts] < '16:00' && @practitioner.converted_working_hours(current_user)[num].first[:ends] > '20:00') || (@practitioner.converted_working_hours(current_user)[num].first[:starts] >= '16:00' && @practitioner.converted_working_hours(current_user)[num].first[:starts] < '20:00') || (@practitioner.converted_working_hours(current_user)[num].first[:ends] > '16:00' && @practitioner.converted_working_hours(current_user)[num].first[:ends] <= '20:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].first[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].first[:ends] %></p></div></div></td>
                  <% elsif (@practitioner.converted_working_hours(current_user)[num].last[:starts] < '16:00' && @practitioner.converted_working_hours(current_user)[num].last[:ends] > '20:00') || (@practitioner.converted_working_hours(current_user)[num].last[:starts] >= '16:00' && @practitioner.converted_working_hours(current_user)[num].last[:starts] < '20:00') || (@practitioner.converted_working_hours(current_user)[num].last[:ends] > '16:00' && @practitioner.converted_working_hours(current_user)[num].last[:ends] <= '20:00') %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].last[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].last[:ends] %></p></div></div></td>
                  <% else %>
                    <td></td>
                  <% end %>
                <% else %>
                  <td></td>
                <% end %>
              <% end %>
              <td class='time'>16 ~ 20</td>
            </tr>
            <tr>
              <% (0..6).to_a.each do |num| %>
                <% if @practitioner.converted_working_hours(current_user)[num] != [] %>
                  <% if @practitioner.converted_working_hours(current_user)[num].last[:ends] > '20:00' %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].last[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].last[:ends] %></p></div></div></td>
                  <% elsif @practitioner.converted_working_hours(current_user)[num].first[:ends] > '20:00' %>
                    <td><div class="available-cell"><div class="available-hours"><p><%= @practitioner.converted_working_hours(current_user)[num].first[:starts] %> ~ <%= @practitioner.converted_working_hours(current_user)[num].first[:ends] %></p></div></div></td>
                  <% else %>
                    <td></td>
                  <% end %>
                <% else %>
                  <td></td>
                <% end %>
              <% end %>
              <td class='time'>20 ~ 24</td>
            </tr>
          <% end %>
        </table>
      </div>
      <% if current_user == @practitioner.user %>
        <%= link_to 'Edit', practitioner_profile_path, class: 'btn btn-flat w-100 mt-3' %>
      <% else %>
        <%= simple_form_for [@practitioner.user, @conversation], html: {class: "w-100"} do |f| %>
          <%= f.submit 'Send message', class: 'btn btn-flat w-100 mt-3' %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    <% @practitioner.reviews.order('created_at DESC').each do |review| %>
      let review<%= review.id %> = document.getElementById('review-text-' + <%= review.id %>);
      if (review<%= review.id %>.clientHeight > 96) {
        let expand<%= review.id %> = document.createElement("a");
        expand<%= review.id %>.innerText = 'Read more';
        expand<%= review.id %>.href = '';
        expand<%= review.id %>.addEventListener('click', (e) => {
          if (expand<%= review.id %>.innerText == 'Read more') {
            e.preventDefault();
            review<%= review.id %>.innerHTML = '';
            review<%= review.id %>.innerHTML = '<%= review.comment.gsub(/\n/, '<br/>').html_safe %>';
            expand<%= review.id %>.innerText = 'Hide';
          } else {
            e.preventDefault();
            review<%= review.id %>.innerHTML = '';
            review<%= review.id %>.innerHTML = '<%= review.comment.gsub(/\n/, '<br/>').html_safe %>';
            while (review<%= review.id %>.clientHeight > 96) {
              review<%= review.id %>.innerText = review<%= review.id %>.innerText.replace(/\W*\s(\S)*$/, '...');
            }
            expand<%= review.id %>.innerText = 'Read more';
          }
        });
        review<%= review.id %>.parentNode.append(expand<%= review.id %>);
      }
      while (review<%= review.id %>.clientHeight > 72) {
        review<%= review.id %>.innerHTML = review<%= review.id %>.innerHTML.replace(/\W*\s(\S)*$/, '...');
      }
    <% end %>
    <% if !user_signed_in? || (user_signed_in? && !current_user.timezone?) %>
      document.getElementById('time-zone').innerHTML = moment.tz.guess();
      const user_time_offset = moment.tz.zone(moment.tz.guess()).utcOffset(Date.now());
      const practitioner_time_offset = moment.tz.zone('<%= @practitioner.timezone %>').utcOffset(Date.now());
      const time_diff = user_time_offset - practitioner_time_offset;
      let converted_working_hours = {};
      <% (0..6).to_a.each do |num| %> converted_working_hours[<%= num %>] = []; <% end %>
      <% @practitioner.working_hours.each do |workingday| %>
        let converted_open_hour_<%= workingday.day %> = '';
        <% unless workingday.opens == nil %>
          converted_open_hour_<%= workingday.day %> = moment('<%= workingday.opens %>').subtract(time_diff, 'm').toISOString();
        <% end %>
        let converted_close_hour_<%= workingday.day %> = '';
        <% unless workingday.closes == nil %>
          if (moment('<%= workingday.closes %>').format("HH:mm") == '00:00') {
            converted_close_hour_<%= workingday.day %> = moment('<%= workingday.closes %>').add(1, 'days').subtract(time_diff, 'm').toISOString();
          } else {
            converted_close_hour_<%= workingday.day %> = moment('<%= workingday.closes %>').subtract(time_diff, 'm').toISOString();
          }
        <% end %>
        if ((converted_open_hour_<%= workingday.day %> != '' ) && (converted_close_hour_<%= workingday.day %> != '')) {
          if ((<%= workingday.day %> == 1) || (<%= workingday.day %> == 2) || (<%= workingday.day %> == 3) || (<%= workingday.day %> == 4) || (<%= workingday.day %> == 5)) {
            if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '31') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '31')) {
              converted_working_hours[<%= workingday.day %> - 1].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '31') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '01')) {
              converted_working_hours[<%= workingday.day %> - 1].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': '24:00' });
              if ((('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2)) != '00:00') {
                converted_working_hours[<%= workingday.day %>].push({ 'starts': '00:00', 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
              }
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '1') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '01')) {
              converted_working_hours[<%= workingday.day %>].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '1') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '02')) {
              converted_working_hours[<%= workingday.day %>].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': '24:00' });
              converted_working_hours[<%= workingday.day %> + 1].push({ 'starts': '00:00', 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '2') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '02')) {
              converted_working_hours[<%= workingday.day %> + 1].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            }
          } else if (<%= workingday.day %> == 0) {
            if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '31') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '31')) {
              converted_working_hours[6].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '31') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '01')) {
              converted_working_hours[6].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': '24:00' });
              converted_working_hours[<%= workingday.day %>].push({ 'starts': '00:00', 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            }
            else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '1') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '01')) {
              converted_working_hours[<%= workingday.day %>].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '1') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '02')) {
              converted_working_hours[<%= workingday.day %>].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': '24:00' });
              converted_working_hours[<%= workingday.day %> + 1].push({ 'starts': '00:00', 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '2') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '02')) {
              converted_working_hours[<%= workingday.day %> + 1].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            }
          } else if (<%= workingday.day %> == 6) {
            if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '31') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '31')) {
              converted_working_hours[<%= workingday.day %> - 1].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '31') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '01')) {
              converted_working_hours[<%= workingday.day %> - 1].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': '24:00' });
              converted_working_hours[<%= workingday.day %>].push({ 'starts': '00:00', 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '1') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '01')) {
              converted_working_hours[<%= workingday.day %>].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '1') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '02')) {
              converted_working_hours[<%= workingday.day %>].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': '24:00' });
              converted_working_hours[0].push({ 'starts': "00:00", 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            } else if ((new Date(converted_open_hour_<%= workingday.day %>).getDate() == '2') && (new Date(converted_close_hour_<%= workingday.day %>).getDate() == '02')) {
              converted_working_hours[0].push({ 'starts': ('0'+new Date(converted_open_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_open_hour_<%= workingday.day %>).getMinutes()).substr(-2), 'ends': ('0'+new Date(converted_close_hour_<%= workingday.day %>).getHours()).substr(-2) + ':' + ('0'+new Date(converted_close_hour_<%= workingday.day %>).getMinutes()).substr(-2) });
            }
          }
        }
      <% end %>
      const table = document.getElementsByTagName('table')[0];
      let html = '';
      html += `<tr>`;
      for (var i = 0; i < 7; i++) {
        if (converted_working_hours[i].length == 1) {
          if ((converted_working_hours[i][0]['starts'] < '04:00') && (converted_working_hours[i][0]['ends'] != '00:00')) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else if (converted_working_hours[i].length == 2) {
          if ((converted_working_hours[i][0]['starts'] < '04:00') && (converted_working_hours[i][0]['ends'] != '00:00')) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else if ((converted_working_hours[i][1]['starts'] < '04:00') && (converted_working_hours[i][1]['ends'] != '00:00')) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][1]['starts'] +` ~ `+ converted_working_hours[i][1]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else {
          html += `<td></td>`;
        }
      }
      html += `<td class='time'>00 ~ 04</td>
               </tr>`;
      html += `<tr>`;
      for (var i = 0; i < 7; i++) {
        if (converted_working_hours[i].length == 1) {
          if (((converted_working_hours[i][0]['starts'] < '04:00') && (converted_working_hours[i][0]['ends'] > '08:00')) || ((converted_working_hours[i][0]['starts'] >= '04:00') && (converted_working_hours[i][0]['starts'] < '08:00')) || ((converted_working_hours[i][0]['ends'] > '04:00') && (converted_working_hours[i][0]['ends'] <= '08:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else if (converted_working_hours[i].length == 2) {
          if (((converted_working_hours[i][0]['starts'] < '04:00') && (converted_working_hours[i][0]['ends'] > '08:00')) || ((converted_working_hours[i][0]['starts'] >= '04:00') && (converted_working_hours[i][0]['starts'] < '08:00')) || ((converted_working_hours[i][0]['ends'] > '04:00') && (converted_working_hours[i][0]['ends'] <= '08:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else if (((converted_working_hours[i][1]['starts'] < '04:00') && (converted_working_hours[i][1]['ends'] > '08:00')) || ((converted_working_hours[i][1]['starts'] >= '04:00') && (converted_working_hours[i][1]['starts'] < '08:00')) || ((converted_working_hours[i][1]['ends'] > '04:00') && (converted_working_hours[i][1]['ends'] <= '08:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][1]['starts'] +` ~ `+ converted_working_hours[i][1]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else {
          html += `<td></td>`;
        }
      }
      html += `<td class='time'>04 ~ 08</td>
               </tr>`;
      html += `<tr>`;
      for (var i = 0; i < 7; i++) {
        if (converted_working_hours[i].length == 1) {
          if (((converted_working_hours[i][0]['starts'] < '08:00') && (converted_working_hours[i][0]['ends'] > '12:00')) || ((converted_working_hours[i][0]['starts'] >= '08:00') && (converted_working_hours[i][0]['starts'] < '12:00')) || ((converted_working_hours[i][0]['ends'] > '08:00') && (converted_working_hours[i][0]['ends'] <= '12:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else if (converted_working_hours[i].length == 2) {
          if (((converted_working_hours[i][0]['starts'] < '08:00') && (converted_working_hours[i][0]['ends'] > '12:00')) || ((converted_working_hours[i][0]['starts'] >= '08:00') && (converted_working_hours[i][0]['starts'] < '12:00')) || ((converted_working_hours[i][0]['ends'] > '08:00') && (converted_working_hours[i][0]['ends'] <= '12:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else if (((converted_working_hours[i][1]['starts'] < '08:00') && (converted_working_hours[i][1]['ends'] > '12:00')) || ((converted_working_hours[i][1]['starts'] >= '08:00') && (converted_working_hours[i][1]['starts'] < '12:00')) || ((converted_working_hours[i][1]['ends'] > '08:00') && (converted_working_hours[i][1]['ends'] <= '12:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][1]['starts'] +` ~ `+ converted_working_hours[i][1]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else {
          html += `<td></td>`;
        }
      }
      html += `<td class='time'>08 ~ 12</td>
               </tr>`;
      html += `<tr>`;
      for (var i = 0; i < 7; i++) {
        if (converted_working_hours[i].length == 1) {
          if (((converted_working_hours[i][0]['starts'] < '12:00') && (converted_working_hours[i][0]['ends'] > '16:00')) || ((converted_working_hours[i][0]['starts'] >= '12:00') && (converted_working_hours[i][0]['starts'] < '16:00')) || ((converted_working_hours[i][0]['ends'] > '12:00') && (converted_working_hours[i][0]['ends'] <= '16:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else if (converted_working_hours[i].length == 2) {
          if (((converted_working_hours[i][0]['starts'] < '12:00') && (converted_working_hours[i][0]['ends'] > '16:00')) || ((converted_working_hours[i][0]['starts'] >= '12:00') && (converted_working_hours[i][0]['starts'] < '16:00')) || ((converted_working_hours[i][0]['ends'] > '12:00') && (converted_working_hours[i][0]['ends'] <= '16:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else if (((converted_working_hours[i][1]['starts'] < '12:00') && (converted_working_hours[i][1]['ends'] > '16:00')) || ((converted_working_hours[i][1]['starts'] >= '12:00') && (converted_working_hours[i][1]['starts'] < '16:00')) || ((converted_working_hours[i][1]['ends'] > '12:00') && (converted_working_hours[i][1]['ends'] <= '16:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][1]['starts'] +` ~ `+ converted_working_hours[i][1]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else {
          html += `<td></td>`;
        }
      }
      html += `<td class='time'>12 ~ 16</td>
               </tr>`;
      html += `<tr>`;
      for (var i = 0; i < 7; i++) {
        if (converted_working_hours[i].length == 1) {
          if (((converted_working_hours[i][0]['starts'] < '16:00') && (converted_working_hours[i][0]['ends'] > '20:00')) || ((converted_working_hours[i][0]['starts'] >= '16:00') && (converted_working_hours[i][0]['starts'] < '20:00')) || ((converted_working_hours[i][0]['ends'] > '16:00') && (converted_working_hours[i][0]['ends'] <= '20:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else if (converted_working_hours[i].length == 2) {
          if (((converted_working_hours[i][0]['starts'] < '16:00') && (converted_working_hours[i][0]['ends'] > '20:00')) || ((converted_working_hours[i][0]['starts'] >= '16:00') && (converted_working_hours[i][0]['starts'] < '20:00')) || ((converted_working_hours[i][0]['ends'] > '16:00') && (converted_working_hours[i][0]['ends'] <= '20:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else if (((converted_working_hours[i][1]['starts'] < '16:00') && (converted_working_hours[i][1]['ends'] > '20:00')) || ((converted_working_hours[i][1]['starts'] >= '16:00') && (converted_working_hours[i][1]['starts'] < '20:00')) || ((converted_working_hours[i][1]['ends'] > '16:00') && (converted_working_hours[i][1]['ends'] <= '20:00'))) {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][1]['starts'] +` ~ `+ converted_working_hours[i][1]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else {
          html += `<td></td>`;
        }
      }
      html += `<td class='time'>16 ~ 20</td>
               </tr>`;
      html += `<tr>`;
      for (var i = 0; i < 7; i++) {
        if (converted_working_hours[i].length == 1) {
          if (converted_working_hours[i][0]['ends'] > '20:00') {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else if (converted_working_hours[i].length == 2) {
          if (converted_working_hours[i][0]['ends'] > '20:00') {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][0]['starts'] +` ~ `+ converted_working_hours[i][0]['ends'] +`</p></div></div></td>`;
          } else if (converted_working_hours[i][1]['ends'] > '20:00') {
            html += `<td><div class="available-cell"><div class="available-hours"><p>`+ converted_working_hours[i][1]['starts'] +` ~ `+ converted_working_hours[i][1]['ends'] +`</p></div></div></td>`;
          } else {
            html += `<td></td>`;
          }
        } else {
          html += `<td></td>`;
        }
      }
      html += `<td class='time'>20 ~ 24</td>
               </tr>`;
      table.insertAdjacentHTML('beforeend', html);
    <% elsif user_signed_in? && current_user.timezone? %>
      document.getElementById('time-zone').innerHTML = '<%= current_user.timezone %>';
    <% end %>
  });
</script>
