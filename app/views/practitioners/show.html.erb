<div class="container practitioner-page">
  <div class="practitioner-summary">
    <div class="practitioner-img">
      <% if @practitioner.photo.attached? %>
        <%= cl_image_tag @practitioner.photo.key, class: 'avatar-full' %>
      <% else %>
        <img src='https://kitt.lewagon.com/placeholder/users/random' class='avatar-full' />
      <% end %>
    </div>
    <div class="practitioner-body">
      <div class="practitioner-name">
        <button class="verified">Verified</button>
        <h3><%= @practitioner.user.full_name %></h3>
        <p class="practitioner-rating">
          <% if @practitioner.reviews.count > 0 %>
            <i class="fas fa-star mr-2 pink-icon"></i><%= @practitioner.rating_avg %> (<%= @practitioner.reviews.count %>)
          <% else %>
            No reviews!
          <% end %>
        </p>
      </div>
      <div class="practitioner-detail">
        <p>Specailty:
          <%= @practitioner.specialties.pluck(:name).join(', ') %>
        </p>
        <p>Languages:
          <%= @practitioner.languages.pluck(:name).join(', ') %>
        </p>
        <p>Working days:
          <%= @practitioner.working_days %>
        </p>
        <p>Working hours:
          <% if user_signed_in? %>
            <% if @practitioner.starting_hour && @practitioner.ending_hour %><%= DateTime.new(Time.current.year, Time.current.month, Time.current.day, @practitioner.starting_hour.hour, @practitioner.starting_hour.min, 0).in_time_zone(current_user.timezone).strftime('%H:%M') %> ~ <%= DateTime.new(Time.current.year, Time.current.month, Time.current.day, @practitioner.ending_hour.hour, @practitioner.ending_hour.min, 0).in_time_zone(current_user.timezone).strftime('%H:%M') %><% end %>
          <% else %>
            <span id=working-hours></span>
          <% end %>
        </p>
      </div>
    </div>
    <div class="practitioner-btn" id="practitioner-btn">
      <%= render 'favorite_practitioners/practitioner_btn', practitioner: @practitioner %>
    </div>
  </div>
  <div class="practitioner-description">
    <div class="practitioner-description-left">
      <div class="practitioner-bio">
        <h3>Bio</h3>
        <p><%= @practitioner.bio %></p>
      </div>
      <div class="practitioner-services">
        <h3>Services</h3>
        <% @practitioner.services.each do |service| %>
          <div class="practitioner-service">
            <div class="practitioner-service-info">
              <div class="d-flex justify-content-between align-items-center">
                <h4><%= service.name %></h4>
                <% if current_user != @practitioner.user %>
                  <%= link_to 'Book now', service_path(service), class: 'btn btn-flat' %>
                <% end %>
              </div>
              <% if service.reviews.count > 0 %>
                <p><i class="fas fa-star mr-2 pink-icon"></i><%= service.rating_avg %> (<%= service.reviews.count %>)</p>
              <% else %>
                <p>No reviews!</p>
              <% end %>
              <p>Service Type: <%= service.service_type.capitalize %></p>
              <p>Duration: <%= service.duration %>m</p>
              <p>Service Price: CA<%= humanized_money_with_symbol(service.price) %></p>
              <div class="practitioner-service-description">
                <p><%= service.description %></p>
                <!-- <button>+ show more</button> -->
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="practitioner-description-right">
      <div class="practitioner-video">
        <div class="embed-responsive embed-responsive-16by9">
          <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/<%= @practitioner.video %>?autoplay=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
      </div>
      <div class="practitioner-review mt-5">
        <% @practitioner.reviews.each do |review| %>
          <p><% review.rating.times { %> <i class="fas fa-star pink-icon"></i> <% } %> - <%= review.comment %> <small><i>by <%= review.session.user.full_name %></i></small></p>
        <% end %>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById('working-hours')) {
      const tz = jstz.determine();
      <% if @practitioner.starting_hour && @practitioner.ending_hour %>
        document.getElementById('working-hours').innerText = moment("<%= DateTime.new(Time.current.year, Time.current.month, Time.current.day, @practitioner.starting_hour.hour, @practitioner.starting_hour.min, 0).strftime('%FT%RZ') %>").tz(tz.name()).format('HH:mm') + ' ~ ' + moment("<%= DateTime.new(Time.current.year, Time.current.month, Time.current.day, @practitioner.ending_hour.hour, @practitioner.ending_hour.min, 0).strftime('%FT%RZ') %>").tz(tz.name()).format('HH:mm');
      <% end %>
    }
  });
</script>
